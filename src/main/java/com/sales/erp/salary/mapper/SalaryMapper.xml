<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
     
	<mapper namespace="com.sales.erp.salary.dao.SalaryMapper">
		<select id="selectMonthlyPerformance" parameterType="com.sales.erp.salary.vo.VOforSQL" resultType="com.sales.erp.order.vo.OrderJoinVO">
			<![CDATA[
			SELECT O.ID AS ID, O.EMPNO AS EMPNO, O.REGDATE AS REGDATE,
			S.NAME AS NAME, S.TEAM AS TEAM, S.AUTH AS AUTH,
			O.PROCODE AS PROCODE, P.PRONAME AS PRONAME, O.PROAMOUNT AS PROAMOUNT,
			((P.SELLPRICE-P.ORIGINPRICE)*O.PROAMOUNT) AS PROFIT,
			(P.SELLPRICE*O.PROAMOUNT) AS SALES,
			O.CUSTOMER AS CUSTOMER, O.ADDRESS AS ADDRESS, O.CHECKS AS CHECKS,
			O.DELETED AS DELETED
			FROM ORDERS O, 
			(SELECT EMPNO, NAME, TEAM, AUTH FROM SMEMBER) S,
			(SELECT PROCODE, PRONAME, PROAMOUNT, ORIGINPRICE, SELLPRICE FROM PRODUCT) P
			WHERE O.EMPNO=S.EMPNO AND O.PROCODE=P.PROCODE AND CHECKS=1
			AND DELETED=0 AND O.EMPNO=#{empno}
			AND O.REGDATE>=TO_DATE(#{startdate}, 'YYYYMMDDHH24MISS')
			AND O.REGDATE<=TO_DATE(#{enddate}, 'YYYYMMDDHH24MISS')
			]]>
		</select>
		
		<select id="profitSum" parameterType="com.sales.erp.salary.vo.VOforSQL" resultType="java.lang.String">
			<![CDATA[
			SELECT SUM((P.SELLPRICE-P.ORIGINPRICE)*O.PROAMOUNT) AS PROFITSUM
			FROM ORDERS O, 
			(SELECT EMPNO, NAME, TEAM, AUTH FROM SMEMBER) S,
			(SELECT PROCODE, PRONAME, PROAMOUNT, ORIGINPRICE, SELLPRICE FROM PRODUCT) P
			WHERE O.EMPNO=S.EMPNO AND O.PROCODE=P.PROCODE AND CHECKS=1
			AND DELETED=0 AND O.EMPNO=#{empno}
			AND O.REGDATE>=TO_DATE(#{startdate}, 'YYYYMMDDHH24MISS')
			AND O.REGDATE<=TO_DATE(#{enddate}, 'YYYYMMDDHH24MISS')
			GROUP BY O.EMPNO
			]]>
		</select>
	</mapper>